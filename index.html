<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ—è…«ç˜¤èˆ‡ä»£è¬é˜²è­·ï¼šå€‹äººåŒ–é»ƒé‡‘èª²è¡¨</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d9488">
    <link rel="apple-touch-icon" href="icon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fdfbf7; color: #4a4a4a; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .timeline-line { position: absolute; left: 24px; top: 0; bottom: 0; width: 2px; background: #e5e7eb; z-index: 0; }
        .timeline-dot { position: relative; z-index: 10; }
        .active-tab { border-bottom: 2px solid #0d9488; color: #0d9488; font-weight: 700; }
        .inactive-tab { color: #9ca3af; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 350px; max-height: 400px; }
        
        /* Custom scrollbar for data lists */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
    
    <script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
    </script>
</head>
<body class="bg-[#fdfbf7] min-h-screen pb-12">

    <header class="bg-white border-b border-gray-100 sticky top-0 z-50 shadow-sm">
        <div class="max-w-5xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-2xl font-bold text-slate-800 tracking-tight">æŠ—è…«ç˜¤èˆ‡ä»£è¬é˜²è­·æˆ°ç•¥ä¸­å¿ƒ</h1>
                <p class="text-sm text-slate-500 mt-1">é‡å°é ¸å‹•è„ˆé«”ç˜¤ (4cm) èˆ‡è¼•å‹åœ°ä¸­æµ·å‹è²§è¡€ä¹‹æ•´åˆç…§è­·</p>
            </div>
            <div class="flex flex-col items-end gap-2">
                <div class="flex gap-2">
                    <div id="today-badge" class="px-3 py-1.5 bg-indigo-50 text-indigo-700 text-xs font-bold rounded-lg border border-indigo-100 shadow-sm flex items-center whitespace-nowrap">
                        <i class="fa-regular fa-calendar-check mr-1.5"></i>è¼‰å…¥ä¸­...
                    </div>
                    <button onclick="enableSmartNotifications()" id="notify-btn" class="px-3 py-1.5 bg-teal-50 text-teal-700 text-xs font-bold rounded-lg border border-teal-100 shadow-sm hover:bg-teal-100 transition whitespace-nowrap flex items-center">
                        <i class="fa-regular fa-bell mr-1.5"></i>é–‹å•Ÿ 30 åˆ†é˜å‰æ¨æ’­
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 mt-8 space-y-12">

        <section class="text-center max-w-3xl mx-auto">
            <h2 class="text-xl font-semibold text-slate-700 mb-3">æˆ°ç•¥ç¸½è¦½</h2>
            <p class="text-slate-600 leading-relaxed text-sm md:text-base">
                æœ¬è¨ˆåŠƒæ—¨åœ¨é€éç²¾æº–çš„ç”Ÿç‰©åŒ–å­¸è·¯å¾‘å¹²é ï¼ˆMetabolic Interventionï¼‰ï¼Œåœ¨æš«ä¸æ‰‹è¡“çš„æƒ…æ³ä¸‹å»¶ç·©è…«ç˜¤ç”Ÿé•·ã€‚
                æ ¸å¿ƒé‚è¼¯åœ¨æ–¼åˆ‡æ–·è…«ç˜¤çš„èƒ½é‡ä¾›æ‡‰ï¼ˆmTORï¼‰ã€é˜»æ–·å…¶æ±‚æ•‘è¨Šè™Ÿï¼ˆHIF-1Î±ï¼‰ï¼Œä¸¦æ”¹å–„å¾®ç’°å¢ƒç™¼ç‚ï¼ˆNF-ÎºBï¼‰ï¼ŒåŒæ™‚å…¼é¡§è²§è¡€é«”è³ªçš„æ°§åŒ–å£“åŠ›é˜²è­·ã€‚
            </p>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2 space-y-6">
                <div class="flex justify-between items-end mb-2 border-b border-slate-200 pb-2">
                    <h3 class="text-lg font-bold text-slate-800">åŸ·è¡Œæ—¥ç¨‹è¡¨</h3>
                    <div class="flex space-x-3 text-sm font-medium" id="scheduleTabs">
                        <button onclick="switchRoute('A')" id="btn-A" class="active-tab transition-colors">ğŸ”´ è·¯ç·š A</button>
                        <button onclick="switchRoute('B')" id="btn-B" class="inactive-tab hover:text-slate-600 transition-colors">ğŸ”µ è·¯ç·š B</button>
                        <button onclick="switchRoute('Rest')" id="btn-Rest" class="inactive-tab hover:text-slate-600 transition-colors">ğŸŒ´ ä¼‘è€•æ—¥</button>
                    </div>
                </div>

                <div id="scheduleContainer" class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative min-h-[450px]">
                    </div>
            </div>

            <div class="space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="text-lg font-bold text-slate-800 mb-4">æˆ°ç•¥è¦†è“‹ç‡åˆ†æ</h3>
                    <p class="text-xs text-slate-500 mb-4">åˆ†æä¸åŒè·¯ç·šå°é—œéµè‡´ç™Œè·¯å¾‘çš„æŠ‘åˆ¶å¼·åº¦</p>
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="mt-4 space-y-3">
                        <div class="p-3 bg-red-50 rounded-lg border border-red-100">
                            <h4 class="text-xs font-bold text-red-800 uppercase mb-1">è·¯ç·š A ç„¦é»</h4>
                            <p class="text-xs text-red-700">èƒ½é‡é˜»æ–· (AMPK/mTOR) èˆ‡è¡€ç®¡æ–°ç”ŸæŠ‘åˆ¶ã€‚è¿«ä½¿è…«ç˜¤ä¼‘çœ ã€‚</p>
                        </div>
                        <div class="p-3 bg-blue-50 rounded-lg border border-blue-100">
                            <h4 class="text-xs font-bold text-blue-800 uppercase mb-1">è·¯ç·š B ç„¦é»</h4>
                            <p class="text-xs text-blue-700">æŠ—ç¼ºæ°§ç’°å¢ƒ (HIF-1Î± é™è§£) èˆ‡æŠ—ç™¼ç‚ã€‚æ¸…é™¤ç™¼ç‚ä»‹è³ªã€‚</p>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-lg">
                    <h3 class="text-lg font-bold mb-3">ğŸ›¡ï¸ é˜²è­·é‡é»æç¤º</h3>
                    <ul class="space-y-3 text-sm text-slate-300">
                        <li class="flex items-start gap-2">
                            <span class="text-amber-400 font-bold shrink-0">è²§è¡€é˜²è­·ï¼š</span>
                            <span>EGCG è¯åˆæ¸¸é›¢éµï¼Œé¿å…ç´…è¡€çƒæ°§åŒ–ç ´å£ã€‚</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-teal-400 font-bold shrink-0">è‚è‡Ÿä¼‘æ¯ï¼š</span>
                            <span>é€±æ—¥å…¨é¢åœç”¨æ¤åŒ–ç´ ï¼Œé¿å…é…µç´ èª˜å°ç”¢ç”ŸæŠ—è—¥æ€§ã€‚</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-purple-400 font-bold shrink-0">è—¥ç‰©å€éš”ï¼š</span>
                            <span>Lipanthyl æ–¼æ™šé¤æœç”¨ï¼Œèˆ‡æ—¥é–“ä¿å¥å“ä»£è¬æ™‚é–“éŒ¯é–‹ã€‚</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <section class="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-slate-100">
            <div class="mb-6 border-b border-gray-100 pb-4">
                <h3 class="text-xl font-bold text-slate-800">æˆ°ç•¥åœ°åœ–ï¼šå¦‚ä½•å°é–è…«ç˜¤ç”Ÿé•·</h3>
                <p class="text-sm text-slate-500 mt-2">æ­¤åœ–å±•ç¤ºäº†è…«ç˜¤ç”Ÿé•·çš„é—œéµè·¯å¾‘ï¼Œä»¥åŠæ‚¨çš„èª²è¡¨å¦‚ä½•åœ¨ä¸åŒç¯€é»é€²è¡Œæ””æˆªã€‚</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center items-stretch relative">
                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200 flex flex-col items-center relative group transition-all hover:bg-slate-100 hover:border-slate-300 hover:shadow-md">
                    <div class="text-2xl mb-2">ğŸŒ‘</div>
                    <h4 class="font-bold text-slate-700">å¾®ç’°å¢ƒç¼ºæ°§</h4>
                    <p class="text-xs text-slate-500 mt-1">è…«ç˜¤é•·å¤ªå¿«å°è‡´å…§éƒ¨ç¼ºæ°§</p>
                    <div class="mt-3 w-full border-t border-slate-200 pt-2">
                        <span class="text-xs font-bold text-teal-600 block">ç´…æ™¯å¤© (O2 å„ªåŒ–)</span>
                    </div>
                    <div class="hidden md:block absolute -right-6 top-1/2 transform -translate-y-1/2 text-slate-300 text-xl">âœ</div>
                </div>

                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200 flex flex-col items-center relative group transition-all hover:bg-slate-100 hover:border-slate-300 hover:shadow-md">
                    <div class="text-2xl mb-2">ğŸš¨</div>
                    <h4 class="font-bold text-slate-700">HIF-1Î± å•Ÿå‹•</h4>
                    <p class="text-xs text-slate-500 mt-1">ç¼ºæ°§èª˜å°å› å­ç™¼å‡ºæ±‚æ•‘è¨Šè™Ÿ</p>
                    <div class="mt-3 w-full border-t border-slate-200 pt-2">
                        <span class="text-xs font-bold text-blue-600 block">è˜¿è””ç¡«ç´  (é™è§£)</span>
                        <span class="text-xs font-bold text-teal-600 block">ç´…æ™¯å¤© (æŠ‘åˆ¶)</span>
                    </div>
                     <div class="hidden md:block absolute -right-6 top-1/2 transform -translate-y-1/2 text-slate-300 text-xl">âœ</div>
                </div>

                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200 flex flex-col items-center relative group transition-all hover:bg-slate-100 hover:border-slate-300 hover:shadow-md">
                    <div class="text-2xl mb-2">ğŸ§¬</div>
                    <h4 class="font-bold text-slate-700">VEGF åˆ†æ³Œ</h4>
                    <p class="text-xs text-slate-500 mt-1">è¡€ç®¡å…§çš®ç”Ÿé•·å› å­ (è‚¥æ–™)</p>
                    <div class="mt-3 w-full border-t border-slate-200 pt-2">
                        <span class="text-xs font-bold text-purple-600 block">ç™½è—œè˜†é†‡ (SIRT1)</span>
                        <span class="text-xs font-bold text-emerald-600 block">EGCG (æŠ‘åˆ¶åˆ†è£‚)</span>
                    </div>
                     <div class="hidden md:block absolute -right-6 top-1/2 transform -translate-y-1/2 text-slate-300 text-xl">âœ</div>
                </div>

                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200 flex flex-col items-center relative group transition-all hover:bg-slate-100 hover:border-slate-300 hover:shadow-md">
                    <div class="text-2xl mb-2">âš¡</div>
                    <h4 class="font-bold text-slate-700">èƒ½é‡èˆ‡ç™¼ç‚</h4>
                    <p class="text-xs text-slate-500 mt-1">mTOR ç”Ÿé•· / COX-2 ç™¼ç‚</p>
                    <div class="mt-3 w-full border-t border-slate-200 pt-2">
                        <span class="text-xs font-bold text-amber-600 block">å°æª—é¹¼ (AMPK)</span>
                        <span class="text-xs font-bold text-orange-600 block">è–‘é»ƒç´  (æŠ—ç™¼ç‚)</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="space-y-6">
            <div class="flex items-center gap-3 mb-2">
                <div class="h-8 w-1 bg-teal-500 rounded-full"></div>
                <div>
                    <h3 class="text-xl font-bold text-slate-800">ç ”ç©¶æ“´å……ï¼šå»¶ç·©è…«ç˜¤ç”Ÿé•·çš„å…¶ä»–æ½›åœ¨è·¯å¾‘</h3>
                    <p class="text-sm text-slate-500">æ•´ç†ä»¥ä¸‹å…·é†«å­¸æ–‡ç»æ”¯æŒçš„é«”å¤–/å‹•ç‰©å¯¦é©—åƒè€ƒæ–¹å‘ (Adjuvant Therapies)ã€‚</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card p-6 border-l-4 border-indigo-500">
                    <div class="flex justify-between items-start">
                        <h4 class="font-bold text-slate-800 text-lg">1. è¤ªé»‘æ¿€ç´  (Melatonin)</h4>
                        <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs font-bold">å¤œé–“ä¿®å¾©</span>
                    </div>
                    <div class="mt-3 text-sm text-slate-600 space-y-2">
                        <p><strong>ç ”ç©¶æ©Ÿåˆ¶ï¼š</strong> è¤ªé»‘æ¿€ç´ åœ¨è…«ç˜¤å­¸ä¸­è¢«è¦–ç‚ºå¼·æ•ˆçš„ã€Œè¡€ç®¡æ–°ç”ŸæŠ‘åˆ¶åŠ‘ã€ã€‚èƒ½é™ä½ VEGF è¡¨é”ï¼Œä¸¦ä¿è­·è²§è¡€æ‚£è€…çš„ç´…è¡€çƒè†œã€‚</p>
                        <p><strong>æ½›åœ¨æ‡‰ç”¨ï¼š</strong> ä½œç‚ºå¤œé–“å°æŠ— HIF-1Î± çš„é˜²ç·šã€‚</p>
                    </div>
                </div>

                <div class="card p-6 border-l-4 border-yellow-500">
                    <div class="flex justify-between items-start">
                        <h4 class="font-bold text-slate-800 text-lg">2. ç¶­ç”Ÿç´  D3 (Vitamin D3)</h4>
                        <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-bold">åŸºè³ªç©©å›º</span>
                    </div>
                    <div class="mt-3 text-sm text-slate-600 space-y-2">
                        <p><strong>ç ”ç©¶æ©Ÿåˆ¶ï¼š</strong> è…«ç˜¤å¾®ç’°å¢ƒé€šå¸¸å‘ˆç¾é…¸æ€§ã€‚ç¶­ç”Ÿç´  D3 èƒ½ä¿ƒé€²ç´°èƒåˆ†åŒ–ï¼Œå¢å¼·ç´°èƒé–“è³ªçš„é€£çµï¼Œä½¿è…«ç˜¤è¼ƒé›£å‘å¤–æ“´å¼µã€‚</p>
                        <p><strong>å»ºè­°è¡Œå‹•ï¼š</strong> ç¶­æŒè¡€æ¸…æ¿ƒåº¦åœ¨ 50-70 ng/mL å°æ–¼è…«ç˜¤æ§åˆ¶è¼ƒç‚ºç†æƒ³ã€‚</p>
                    </div>
                </div>

                <div class="card p-6 border-l-4 border-emerald-500">
                    <div class="flex justify-between items-start">
                        <h4 class="font-bold text-slate-800 text-lg">3. èŠ¹èœç´  èˆ‡ æ§²çš®ç´ </h4>
                        <span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded text-xs font-bold">å”åŒæ‰“æ“Š</span>
                    </div>
                    <div class="mt-3 text-sm text-slate-600 space-y-2">
                        <p><strong>ç ”ç©¶æ©Ÿåˆ¶ï¼š</strong> æ§²çš®ç´ èˆ‡ EGCG æœ‰é«˜åº¦å”åŒä½œç”¨ï¼Œèƒ½é˜»æ–· HIF-1Î±ã€‚èŠ¹èœç´ å‰‡èƒ½é™ä½ IGF-1 (é¡èƒ°å³¶ç´ ç”Ÿé•·å› å­)ã€‚</p>
                        <p><strong>æ•´åˆå»ºè­°ï¼š</strong> å¯è€ƒæ…®æ´‹è”¥ã€èŠ¹èœã€å·´è¥¿é‡Œç­‰å¯Œå«æ­¤é¡æ¤åŒ–ç´ çš„é£²é£Ÿã€‚</p>
                    </div>
                </div>

                <div class="card p-6 border-l-4 border-rose-500">
                    <div class="flex justify-between items-start">
                        <h4 class="font-bold text-slate-800 text-lg">4. é…®é«”ä»£è¬/ä½é†£ç­–ç•¥</h4>
                        <span class="bg-rose-100 text-rose-700 px-2 py-1 rounded text-xs font-bold">é¤“æ­»ç™Œç´°èƒ</span>
                    </div>
                    <div class="mt-3 text-sm text-slate-600 space-y-2">
                        <p><strong>ç ”ç©¶æ©Ÿåˆ¶ï¼š</strong> ç“¦æ°æ•ˆæ‡‰æŒ‡å‡ºè…«ç˜¤é«˜åº¦ä¾è³´è‘¡è„ç³–ã€‚é€éé™ä½é†£é¡æ”å–å¼·è¿«èº«é«”ä½¿ç”¨é…®é«”ï¼Œèƒ½é”åˆ°ã€Œä»£è¬é£¢é¤“ã€ã€‚</p>
                        <p><strong>æ³¨æ„ï¼š</strong> éœ€è©•ä¼°è²§è¡€é«”è³ªï¼Œå»ºè­°æº«å’ŒåŸ·è¡Œï¼ˆå¦‚æ¸›å°‘ç²¾ç·»æ¾±ç²‰ï¼‰ã€‚</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="mt-12 py-8 bg-slate-50 border-t border-slate-200 text-center">
        <p class="text-slate-400 text-xs">æœ¬é é¢åƒ…ä¾›å¥åº·ç®¡ç†åƒè€ƒï¼Œä¸ä»£è¡¨é†«ç™‚è¨ºæ–·ã€‚æ‰€æœ‰è£œå……å“ä½¿ç”¨è«‹è«®è©¢ä¸»æ²»é†«å¸«ã€‚</p>
    </footer>

    <script>
        // --- Data Definitions ---
        const scheduleData = {
            'A': {
                title: 'è·¯ç·š Aï¼šä»£è¬å¹²æ“¾èˆ‡é˜²è­·æ—¥ (ä¸€ã€ä¸‰ã€äº”)',
                colorName: 'red',
                desc: 'æ ¸å¿ƒæˆ°ç•¥ï¼šæ–·é›»æ¨¡å¼ã€‚æ´»åŒ– AMPK åˆ‡æ–·è…«ç˜¤èƒ½é‡ï¼Œæº«å’Œé˜»æ–·å¾®è¡€ç®¡æ–°ç”Ÿï¼Œä¸¦ä¿è­·è²§è¡€é«”è³ªã€‚',
                events: [
                    { time: '07:40', label: 'èµ·åºŠç©ºè…¹', items: ['ä¹³é…¸èŒ x1', 'ç´…æ™¯å¤© x1'], mechanism: 'ç´…æ™¯å¤©å„ªåŒ–æ°§æ°£åˆ©ç”¨ï¼ŒæŠ‘åˆ¶ HIF-1Î± æ±‚æ•‘è¨Šè™Ÿã€‚ä¹³é…¸èŒç©ºè…¹å®šæ®–ã€‚', icon: 'ğŸŒ…' },
                    { time: '08:30', label: 'æ—©é¤éš¨é¤', items: ['å°æª—é¹¼ (Berberine) x1'], mechanism: 'å¼·çƒˆæ´»åŒ– AMPKï¼Œé—œé–‰ mTOR ç”Ÿé•·é–‹é—œï¼Œé¨™è…«ç˜¤èº«é«”è™•æ–¼é£¢é¤“ç‹€æ…‹ã€‚', icon: 'ğŸ³' },
                    { time: '12:00', label: 'åˆé¤é£¯å¾Œ', items: ['EGCG (ç¶ èŒ¶èƒå–) x1'], mechanism: 'æŠ‘åˆ¶è¡€ç®¡å…§çš®ç´°èƒåˆ†è£‚ã€‚æº«å’Œè¯åˆç´…è‚‰ä¸­æ¸¸é›¢éµï¼Œä¿è­·åœ°ä¸­æµ·å‹è²§è¡€ç´…è¡€çƒã€‚', icon: 'ğŸ±' },
                    { time: '18:00', label: 'æ™šé¤éš¨é¤', items: ['Lipanthyl (é™è„‚è—¥) x1'], mechanism: 'æ­¤æ™‚è‚è‡Ÿä»£è¬é€šé“æ·¨ç©ºï¼Œå°ˆå¿ƒä»£è¬è¥¿è—¥ï¼Œé¿å…è—¥ç‰©äº¤äº’ä½œç”¨ã€‚', icon: 'ğŸŒ™' }
                ]
            },
            'B': {
                title: 'è·¯ç·š Bï¼šæŠ—ç¼ºæ°§èˆ‡æŠ—ç™¼ç‚æ—¥ (äºŒã€å››ã€å…­)',
                colorName: 'blue',
                desc: 'æ ¸å¿ƒæˆ°ç•¥ï¼šæ‹†å½ˆå°ˆå®¶ã€‚å¼·åŠ›é™è§£ HIF-1Î± ç¼ºæ°§å¼•æ“ï¼Œæ’²æ»…è…«ç˜¤å¾®ç’°å¢ƒç™¼ç‚ã€‚',
                events: [
                    { time: '07:40', label: 'èµ·åºŠç©ºè…¹', items: ['ä¹³é…¸èŒ x1', 'ç´…æ™¯å¤© x1'], mechanism: 'åŒæ¨£å…ˆè®“ç´…æ™¯å¤©æ‰“é ­é™£ï¼Œå°è…«ç˜¤çš„ç¼ºæ°§å¼•æ“é€²è¡Œã€Œç¬¬ä¸€é‡å£“åˆ¶ã€ã€‚', icon: 'ğŸŒ…' },
                    { time: '08:30', label: 'æ—©é¤éš¨é¤', items: ['åå­—èŠ±ç§‘ (å«é»‘èŠ¥å­é…¶) x1', 'ç™½è—œè˜†é†‡ x1'], mechanism: 'å®Œç¾é€£æ“Šï¼è˜¿è””ç¡«ç´ èˆ‡ç™½è—œè˜†é†‡é€²å ´ï¼Œå°è…«ç˜¤ç¼ºæ°§å¼•æ“é€²è¡Œå¤šé‡æ¯€æ»…ï¼ŒæŠŠ HIF-1Î± å£“åˆ¶åˆ°æœ€ä½é»ï¼', icon: 'ğŸ³' },
                    { time: '12:00', label: 'åˆé¤éš¨é¤', items: ['Longvida è–‘é»ƒç´  x1'], mechanism: 'åˆ©ç”¨åˆé¤æ²¹è„‚æœ€é«˜å¸æ”¶ã€‚æŠ‘åˆ¶ COX-2 èˆ‡ NF-ÎºBï¼Œä¸‹åˆç™¼æ®å¼·å¤§æŠ—ç™¼ç‚èˆ‡æŠ—è¡€ç®¡æ–°ç”Ÿå¨åŠ›ã€‚', icon: 'ğŸ±' },
                    { time: '18:00', label: 'æ™šé¤éš¨é¤', items: ['Lipanthyl (é™è„‚è—¥) x1'], mechanism: 'ç¶­æŒè¡€è„‚æ§åˆ¶ï¼Œç¢ºä¿è¥¿è—¥åœ¨å¤œé–“ç™¼æ®æœ€å¤§é™è¡€è„‚åŠŸæ•ˆã€‚', icon: 'ğŸŒ™' }
                ]
            },
            'Rest': {
                title: 'ğŸŒ´ ä¼‘è€•æ—¥ (æ˜ŸæœŸæ—¥)',
                colorName: 'emerald', // Using emerald for rest day styling safely
                desc: 'æ ¸å¿ƒæˆ°ç•¥ï¼šè‚è‡Ÿé‡ç½®ã€‚åœç”¨æ‰€æœ‰æ¤åŒ–ç´ ï¼Œè®“è‚è‡Ÿé…µç´ ä¼‘æ¯ï¼Œé¿å…è…«ç˜¤ç”¢ç”ŸæŠ—è—¥æ€§ã€‚',
                events: [
                    { time: '07:40', label: 'èµ·åºŠç©ºè…¹', items: ['ä¹³é…¸èŒ x1'], mechanism: 'åƒ…è£œå……ç›Šç”ŸèŒç¶­æŒåŸºç¤è…¸é“å¾®ç”Ÿæ…‹ï¼Œä¸çµ¦äºˆè‚è‡Ÿå£“åŠ›ã€‚', icon: 'ğŸŒ…' },
                    { time: 'å…¨æ—¥', label: 'ä¼‘æ¯æ·¨ç©º', items: ['åœç”¨æ‰€æœ‰ä¿å¥å“'], mechanism: 'åˆ»æ„ç•™ç™½ï¼Œè®“ç´°èƒé€šé“é‡ç½®ï¼Œè®“è‚è‡Ÿæœ‰å……è¶³é»ƒé‡‘æ™‚é–“é€²è¡Œè‡ªé«”ä¿®å¾©ã€‚', icon: 'ğŸŒ´' },
                    { time: '18:00', label: 'æ™šé¤éš¨é¤', items: ['Lipanthyl (é™è„‚è—¥) x1'], mechanism: 'è¥¿è—¥çµ•å°ä¸èƒ½åœã€‚åœ¨ç„¡ä¿å¥å“å¹²æ“¾çš„ç’°å¢ƒä¸‹å°ˆæ³¨è™•ç†è¥¿è—¥ã€‚', icon: 'ğŸŒ™' }
                ]
            }
        };

        const TailwindColors = {
            'red': { border: 'border-red-300', dot: 'bg-red-500' },
            'blue': { border: 'border-blue-300', dot: 'bg-blue-500' },
            'emerald': { border: 'border-emerald-300', dot: 'bg-emerald-500' }
        };

        // --- State Management ---
        let defaultRoute = 'A';
        let currentRoute = 'A';
        let radarChart = null;

        // --- Time Checking Logic ---
        function parseTime(timeStr) {
            if (timeStr === 'å…¨æ—¥') return -1; // å¿½ç•¥ç‰¹å®šæ™‚é–“åˆ¤å®š
            const [h, m] = timeStr.split(':').map(Number);
            return (h * 60) + (m || 0);
        }

        function getCurrentStepIndex(events) {
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            let activeIndex = 0;
            for (let i = 0; i < events.length; i++) {
                if (events[i].time === 'å…¨æ—¥') continue; 
                const stepMinutes = parseTime(events[i].time);
                if (currentMinutes >= stepMinutes) {
                    activeIndex = i;
                } else {
                    break;
                }
            }
            return activeIndex;
        }

        // --- UI Rendering ---
        function renderSchedule(routeKey) {
            const data = scheduleData[routeKey];
            const container = document.getElementById('scheduleContainer');
            
            // åˆ¤æ–·ç•¶ä¸‹æ‡‰è©²é«˜äº®å“ªå€‹æ™‚æ®µ
            const isTodayRoute = (routeKey === defaultRoute);
            const currentStepIdx = isTodayRoute ? getCurrentStepIndex(data.events) : -1;

            let html = `
                <div class="mb-6 border-b border-gray-100 pb-4">
                    <h4 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        ${data.title}
                    </h4>
                    <p class="text-sm text-slate-500 mt-2">${data.desc}</p>
                </div>
                <div class="relative space-y-8 pl-2">
                    <div class="timeline-line"></div>
            `;

            data.events.forEach((event, index) => {
                const isCurrentNow = (index === currentStepIdx);
                const itemsHtml = event.items.map(item => {
                    const badgeColor = item.includes('åœç”¨') ? 'bg-slate-200 text-slate-600' : 'bg-slate-100 text-slate-700';
                    return `<span class="inline-block ${badgeColor} px-2 py-1 rounded-md text-sm font-bold shadow-sm mr-2 mb-1">${item}</span>`;
                }).join('');
                
                // å‹•æ…‹æ¨£å¼åˆ¤æ–·
                const colorObj = TailwindColors[data.colorName];
                const dotColor = isCurrentNow ? 'bg-amber-500' : colorObj.dot;
                const dotPulse = isCurrentNow ? `<div class="absolute left-[20px] top-1 w-4 h-4 rounded-full bg-amber-400 animate-ping transform -translate-x-1/2 z-0"></div>` : '';
                
                const cardBg = isCurrentNow 
                    ? `bg-amber-50 border-2 border-amber-300 shadow-md ring-2 ring-amber-200/50` 
                    : `bg-white border hover:${colorObj.border} shadow-sm border-slate-200 transition-colors`;
                
                const nowBadge = isCurrentNow 
                    ? `<span class="ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-amber-500 text-white shadow-sm animate-pulse whitespace-nowrap"><i class="fa-solid fa-thumbtack mr-1"></i>ç›®å‰æ™‚æ®µ</span>` 
                    : '';
                const timeColor = isCurrentNow ? 'text-amber-600' : 'text-slate-400';

                html += `
                    <div class="relative pl-10 group ${isCurrentNow ? 'z-20' : ''}">
                        ${dotPulse}
                        <div class="timeline-dot absolute left-5 top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm flex items-center justify-center transform -translate-x-1/2 ${dotColor}"></div>
                        
                        <div class="flex flex-col sm:flex-row sm:items-baseline gap-2 mb-1">
                            <div class="flex items-center">
                                <span class="font-mono text-lg font-bold ${timeColor} w-16">${event.time}</span>
                                ${nowBadge}
                            </div>
                            <span class="font-bold text-slate-700 text-lg">${event.label} <span class="text-xl ml-1">${event.icon}</span></span>
                        </div>
                        
                        <div class="p-4 rounded-xl ${cardBg}">
                            <div class="mb-3">${itemsHtml}</div>
                            <p class="text-sm text-slate-600 leading-relaxed bg-white/60 p-3 rounded border border-white/40">
                                <span class="font-bold text-slate-700"><i class="fa-solid fa-user-doctor mr-1 text-indigo-500"></i>é¡§å•è§£æï¼š</span> ${event.mechanism}
                            </p>
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            container.innerHTML = html;
        }

        function switchRoute(route) {
            currentRoute = route;
            
            ['A', 'B', 'Rest'].forEach(r => {
                const btn = document.getElementById(`btn-${r}`);
                if (r === route) {
                    btn.className = 'active-tab pb-2 transition-colors';
                } else {
                    btn.className = 'inactive-tab pb-2 hover:text-slate-600 transition-colors';
                }
            });

            renderSchedule(route);
            updateChart(route);
        }

        // --- Notification Engine ---
        async function enableSmartNotifications() {
            if (!("Notification" in window)) {
                alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´æ¨æ’­é€šçŸ¥åŠŸèƒ½ã€‚");
                return;
            }
            const permission = await Notification.requestPermission();
            if (permission !== 'granted') {
                alert("æ¨æ’­æ¬Šé™å·²è¢«æ‹’çµ•ï¼Œè«‹è‡³æ‰‹æ©Ÿç³»çµ±è¨­å®šä¸­é–‹å•Ÿã€‚");
                return;
            }

            if ('serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.ready;
                
                const btn = document.getElementById('notify-btn');
                btn.innerHTML = `<i class="fa-solid fa-bell-on mr-1.5"></i>æé†’å·²å•Ÿå‹• (æ¥µçœé›»)`;
                btn.className = "px-3 py-1.5 bg-emerald-50 text-emerald-700 text-xs font-bold rounded-lg border border-emerald-100 shadow-sm flex items-center whitespace-nowrap";

                scheduleTodayAlerts(registration);
                alert("âœ… æˆåŠŸè¨»å†Šç³»çµ±ç´šé¬§é˜ï¼\næ™‚é–“åˆ°å‰ 30 åˆ†é˜ï¼Œå°±ç®—é—œé–‰ App ä¹Ÿæœƒæº–æ™‚æ¨æ’­æé†’ã€‚æ­¤åšæ³•ä¸æ¶ˆè€—é¡å¤–èƒŒæ™¯é›»åŠ›ã€‚");
            }
        }

        function scheduleTodayAlerts(registration) {
            const supportsTriggers = 'showTrigger' in Notification.prototype;
            const routeData = scheduleData[defaultRoute];
            const now = new Date();

            routeData.events.forEach((event, index) => {
                // æ’é™¤å…¨æ—¥æˆ–ä¸åƒä¿å¥å“çš„æ™‚æ®µ
                if (event.time === 'å…¨æ—¥' || event.items.includes('åœç”¨æ‰€æœ‰ä¿å¥å“')) return;

                const [h, m] = event.time.split(':').map(Number);
                let targetTime = new Date();
                targetTime.setHours(h, m, 0, 0);
                
                // æ‰£é™¤ 30 åˆ†é˜
                targetTime.setMinutes(targetTime.getMinutes() - 30);

                if (targetTime > now) {
                    const title = `ä¿å¥æˆ°ç•¥æé†’ï¼šå†é30åˆ†é˜ (${event.time})`;
                    const body = `æº–å‚™æœç”¨ï¼š${event.items.join(', ')}\næˆ°ç•¥ï¼š${event.mechanism.substring(0, 30)}...`;

                    if (supportsTriggers) {
                        registration.showNotification(title, {
                            body: body,
                            icon: 'icon.png',
                            vibrate: [200, 100, 200, 100, 200],
                            tag: `alert-${defaultRoute}-${index}`,
                            showTrigger: new TimestampTrigger(targetTime.getTime())
                        });
                    } else {
                        // å‚™ç”¨æ–¹æ¡ˆï¼šé€é Timeout è§¸ç™¼ (è‹¥ç³»çµ±æœªæ®ºæ­»èƒŒæ™¯)
                        const delay = targetTime.getTime() - now.getTime();
                        setTimeout(() => {
                            registration.showNotification(title, {
                                body: body,
                                icon: 'icon.png',
                                vibrate: [200, 100, 200]
                            });
                        }, delay);
                    }
                }
            });
        }

        // --- Chart Logic ---
        function initChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['æŠ‘åˆ¶è¡€ç®¡æ–°ç”Ÿ', 'æŠ—ç™¼ç‚ç’°å¢ƒ', 'èƒ½é‡é˜»æ–· AMPK', 'é™è§£ HIF-1Î±', 'éµè³ªè¯åˆ'],
                    datasets: [{
                        label: 'ç•¶å‰è·¯ç·šå¼·åº¦',
                        data: [0,0,0,0,0],
                        fill: true,
                        backgroundColor: 'rgba(200, 200, 200, 0.2)',
                        borderColor: 'rgb(200, 200, 200)',
                        pointBackgroundColor: 'rgb(200, 200, 200)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(200, 200, 200)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: { line: { borderWidth: 3 } },
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { display: false } 
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateChart(route) {
            if (!radarChart) return;
            let newData, newColor, newBg;

            if (route === 'A') {
                newData = [80, 50, 95, 50, 80]; 
                newColor = 'rgb(220, 38, 38)'; 
                newBg = 'rgba(220, 38, 38, 0.2)';
            } else if (route === 'B') {
                newData = [70, 95, 40, 95, 30]; 
                newColor = 'rgb(37, 99, 235)'; 
                newBg = 'rgba(37, 99, 235, 0.2)';
            } else {
                newData = [20, 30, 20, 20, 20]; 
                newColor = 'rgb(16, 185, 129)'; 
                newBg = 'rgba(16, 185, 129, 0.2)';
            }

            radarChart.data.datasets[0].data = newData;
            radarChart.data.datasets[0].borderColor = newColor;
            radarChart.data.datasets[0].backgroundColor = newBg;
            radarChart.data.datasets[0].pointBackgroundColor = newColor;
            radarChart.data.datasets[0].pointHoverBorderColor = newColor;
            radarChart.update();
        }

        // --- Initialization ---
        window.addEventListener('load', () => {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const daysMap = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
            
            // è¨­å®šä»Šæ—¥è·¯ç·š
            if (dayOfWeek === 0) defaultRoute = 'Rest';
            else if ([1, 3, 5].includes(dayOfWeek)) defaultRoute = 'A';
            else defaultRoute = 'B';
            
            currentRoute = defaultRoute;

            // æ›´æ–° UI å¾½ç« 
            document.getElementById('today-badge').innerHTML = `<i class="fa-regular fa-calendar-check mr-1.5"></i>ä»Šå¤©ç‚º${daysMap[dayOfWeek]}ï¼Œè¼‰å…¥è·¯ç·š ${currentRoute === 'Rest' ? 'ä¼‘è€•æ—¥' : currentRoute}`;

            // è‹¥ä½¿ç”¨è€…å·²é–‹å•Ÿéæ¨æ’­æˆæ¬Šï¼Œæ”¹è®ŠæŒ‰éˆ•å¤–è§€ä¸¦è‡ªå‹•æ’ç¨‹
            if (Notification.permission === 'granted') {
                const btn = document.getElementById('notify-btn');
                btn.innerHTML = `<i class="fa-solid fa-bell mr-1.5"></i>æ¨æ’­å·²å•Ÿå‹•`;
                btn.className = "px-3 py-1.5 bg-emerald-50 text-emerald-700 text-xs font-bold rounded-lg border border-emerald-100 shadow-sm flex items-center whitespace-nowrap";
                
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.ready.then(reg => scheduleTodayAlerts(reg));
                }
            }

            initChart();
            switchRoute(currentRoute);
        });

    </script>
</body>
</html>